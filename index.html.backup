<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>מחולל קלפי D&D</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&family=Cinzel:wght@400..900&family=Frank+Ruhl+Libre:wght@300..900&family=Heebo:wght@100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="ui-improvements.css">
</head>

<body>
  <div id="app">
    <header>
      <h1>מחולל קלפי D&D</h1>
      <p>צור חפצים אגדיים למערכה שלך בעזרת בינה מלאכותית</p>
    </header>

    <main class="main-layout">
      <!-- Right Column: Generation Form -->
      <aside class="sidebar-start glass-panel">
        <h2>יצירת חפץ</h2>
        <form id="generator-form">
          <div class="api-key-section">
            <label for="api-key">מפתח API</label>
            <input type="password" id="api-key" placeholder="הדבק מפתח כאן..." />
          </div>

          <hr class="divider">

          <div class="form-group">
            <label>רמה</label>
            <select id="item-level" name="level">
              <option value="1-4">1-4 (נפוץ)</option>
              <option value="5-10">5-10 (לא נפוץ)</option>
              <option value="11-16">11-16 (נדיר)</option>
              <option value="17+">17+ (אגדי)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="item-type">סוג חפץ</label>
            <select id="item-type">
              <option value="weapon">נשק (Weapon)</option>
              <option value="armor">שריון (Armor)</option>
              <option value="wondrous">חפץ פלא (Wondrous Item)</option>
              <option value="potion">שיקוי (Potion)</option>
              <option value="ring">טבעת (Ring)</option>
              <option value="scroll">מגילה (Scroll)</option>
              <option value="staff">מטה (Staff)</option>
              <option value="wand">שרביט (Wand)</option>
            </select>
          </div>

          <!-- Attunement Checkbox -->
          <div class="form-group checkbox-group">
            <input type="checkbox" id="attunement">
            <label for="attunement">דורש התכווננות? (Requires Attunement)</label>
          </div>

          <!-- Dynamic Fields Container -->
          <div id="dynamic-fields" class="dynamic-fields">
            <!-- Weapon Fields -->
            <div id="weapon-fields" class="hidden">
              <div class="form-group">
                <label for="weapon-damage">נזק (Damage)</label>
                <input type="text" id="weapon-damage" placeholder="e.g. 1d8">
              </div>
              <div class="form-group">
                <label for="damage-type">סוג נזק (Damage Type)</label>
                <select id="damage-type">
                  <option value="slashing">חותך (Slashing)</option>
                  <option value="piercing">דוקר (Piercing)</option>
                  <option value="bludgeoning">מוחץ (Bludgeoning)</option>
                  <option value="fire">אש (Fire)</option>
                  <option value="cold">קור (Cold)</option>
                  <option value="lightning">ברק (Lightning)</option>
                  <option value="necrotic">נקרוטי (Necrotic)</option>
                  <option value="radiant">קורן (Radiant)</option>
                </select>
              </div>
            </div>

            <!-- Armor Fields -->
            <div id="armor-fields" class="hidden">
              <div class="form-group">
                <label for="armor-class">דירוג שריון (AC)</label>
                <input type="number" id="armor-class" placeholder="e.g. 15">
              </div>
            </div>
          </div>

          <div class="form-group hidden" id="subtype-container">
            <label>חפץ ספציפי</label>
            <select id="item-subtype" name="subtype">
              <option value="">-- בחר חפץ --</option>
            </select>
          </div>

          <div class="form-group">
            <label>יכולת / נושא</label>
            <input type="text" id="item-ability" name="ability" placeholder="לדוגמה: נזק אש..." />
          </div>

          <div class="form-group">
            <label for="image-model">מודל תמונה</label>
            <select id="image-model">
              <option value="flux">FLUX (מומלץ)</option>
              <option value="turbo">Turbo (מהיר)</option>
              <option value="midjourney">Midjourney Style</option>
            </select>
          </div>

          <div class="form-group">
            <label for="image-style">סגנון ציור</label>
            <select id="image-style">
              <option value="realistic">ריאליסטי (Realistic)</option>
              <option value="watercolor">צבעי מים וקו (Watercolor & Line Art)</option>
              <option value="oil">ציור שמן (Oil Painting)</option>
              <option value="sketch">רישום עיפרון (Pencil Sketch)</option>
              <option value="dark_fantasy">פנטזיה אפלה (Dark Fantasy)</option>
              <option value="anime">אנימה (Anime)</option>
              <option value="woodcut">תחריט עץ (Woodcut)</option>
              <option value="pixel">פיקסל ארט (Pixel Art)</option>
              <option value="simple_icon">אייקון פשוט (Simple Icon)</option>
            </select>
          </div>

          <div class="button-group">
            <button type="submit" id="generate-btn" class="btn-primary">
              <span class="icon">✨</span> צור חפץ
            </button>
            <button type="button" id="surprise-btn" class="btn-surprise">
              <span class="icon">🎲</span> הפתע אותי
            </button>
            <div id="regenerate-controls" class="hidden">
              <button id="regen-image-btn" class="btn-secondary small-btn">
                <span class="icon">🎨</span> מראה חדש
              </button>
              <button id="regen-stats-btn" class="btn-secondary small-btn">
                <span class="icon">📝</span> תכונות חדשות
              </button>
            </div>
          </div>
          <div id="error-message" class="error-message hidden"></div>
        </form>
      </aside>

      <!-- Center Column: Card Preview -->
      <section class="preview-panel">
        <div class="canvas-container">
          <canvas id="card-canvas" width="600" height="840"></canvas>
          <div id="loading-overlay" class="hidden">
            <div class="loading-content">
              <div class="spinner"></div>
              <p id="loading-text">רוקח את הקסם...</p>
              <button id="cancel-btn" class="secondary-btn"
                style="margin-top: 1rem; background: #4a0000; color: white; border: 1px solid #ff4444;">ביטול</button>
            </div>
          </div>
      </section>

      <!-- Left Column: Refinement Controls -->
      <aside class="sidebar-end glass-panel">
        <h2>עריכה ועיצוב</h2>

        <h3>עריכת תוכן</h3>
        <div id="content-editor" class="hidden space-y-4">

          <!-- Rarity -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">נדירות</label>
            <div class="flex gap-2 items-center mb-2">
              <input type="text" id="edit-rarity"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white">
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="raritySize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="raritySize-display">24px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="raritySize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מיקום:</label>
              <input type="range" id="rarity-offset" min="-100" max="100" value="0" class="flex-1">
            </div>
          </div>

          <!-- Type -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">סוג</label>
            <div class="flex gap-2 items-center mb-2">
              <input type="text" id="edit-type"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white">
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="typeSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="typeSize-display">24px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="typeSize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מיקום:</label>
              <input type="range" id="type-offset" min="-100" max="100" value="0" class="flex-1">
            </div>
          </div>

          <!-- Name -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">שם החפץ</label>
            <div class="flex gap-2 items-center mb-2">
              <input type="text" id="edit-name"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white">
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="nameSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="nameSize-display">60px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="nameSize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מיקום:</label>
              <input type="range" id="name-offset" min="-100" max="100" value="0" class="flex-1">
            </div>
          </div>

          <!-- Ability Name -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">שם יכולת</label>
            <div class="flex gap-2 items-center mb-2">
              <input type="text" id="edit-ability-name"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white">
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="abilityNameSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="abilityNameSize-display">28px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="abilityNameSize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מיקום:</label>
              <input type="range" id="ability-offset" min="-150" max="150" value="0" class="flex-1">
            </div>
          </div>

          <!-- Ability Desc -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">תיאור יכולת</label>
            <div class="flex gap-2 items-start mb-2">
              <textarea id="edit-ability-desc" rows="3"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white"></textarea>
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0 mt-1">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="abilityDescSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="abilityDescSize-display">24px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="abilityDescSize">+</button>
              </div>
            </div>
          </div>

          <!-- Fluff -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">תיאור כללי (פלאף)</label>
            <div class="flex gap-2 items-start mb-2">
              <textarea id="edit-desc" rows="3"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white"></textarea>
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0 mt-1">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="descSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="descSize-display">22px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="descSize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מרווח:</label>
              <input type="range" id="fluff-offset" min="0" max="100" value="20" class="flex-1">
            </div>
          </div>

          <!-- Gold -->
          <div class="control-group">
            <label class="text-sm font-medium text-gray-300 mb-1 block">מחיר (זהב)</label>
            <div class="flex gap-2 items-center mb-2">
              <input type="text" id="edit-gold" value="400"
                class="flex-1 bg-gray-700 border border-gray-600 rounded p-2 text-white">
              <div class="flex items-center gap-1 bg-gray-800 rounded px-2 py-0.5 shrink-0">
                <button type="button" class="font-btn font-decrease text-gray-400 hover:text-white"
                  data-target="goldSize">-</button>
                <span class="font-value text-xs w-8 text-center text-white" id="goldSize-display">24px</span>
                <button type="button" class="font-btn font-increase text-gray-400 hover:text-white"
                  data-target="goldSize">+</button>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <label class="text-xs text-gray-400">מיקום:</label>
              <input type="range" id="gold-offset" min="-100" max="100" value="0" class="flex-1">
            </div>
          </div>
        </div>

        <hr class="divider">

        <h3>עיצוב טקסט</h3>

        <div class="control-group">
          <label>גופן</label>
          <select id="font-family-select">
            <option value="Heebo">Heebo (רגיל)</option>
            <option value="Rubik">Rubik (עגול)</option>
            <option value="Frank Ruhl Libre">Frank Ruhl (ספרותי)</option>
            <option value="Assistant">Assistant (נקי)</option>
          </select>
        </div>

        <hr class="divider">

        <h3>כיוונון תמונה</h3>
        <div class="layout-controls space-y-4">
          <!-- Image -->
          <div class="control-group bg-gray-800 p-3 rounded-lg border border-gray-700">
            <label class="block text-sm font-bold text-amber-500 mb-2">מיקום תמונה</label>
            <input type="range" id="image-offset" min="-150" max="150" value="0" class="w-full">
          </div>
        </div>

        <div class="card-actions">
          <button id="download-btn" class="btn-secondary" disabled>הורד קלף</button>
        </div>
      </aside>
    </main>
  </div>
  <script src="src/dnd-data.js"></script>
  <script src="src/gemini-service.js"></script>
  <script src="src/card-renderer.js"></script>
  <script src="ui-helpers.js"></script>
  <script type="module" src="./main.js"></script>
</body>

</html>