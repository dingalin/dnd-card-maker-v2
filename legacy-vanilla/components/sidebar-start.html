<aside class="sidebar-start glass-panel">
    <h2 data-i18n="sidebar.createItem">יצירת חפץ</h2>

    <!-- Mode Toggle Switch -->
    <div class="mode-toggle-container" id="mode-toggle-container">
        <span class="mode-label mode-label-auto active" data-i18n="modes.auto">🤖 אוטומטי</span>
        <label class="mode-toggle-switch">
            <input type="checkbox" id="mode-toggle" />
            <span class="mode-toggle-slider"></span>
        </label>
        <span class="mode-label mode-label-manual" data-i18n="modes.manual">🛠️ ידני</span>
    </div>

    <form id="generator-form">

        <!-- Stone Menu Navigation -->
        <div class="stone-menu">
            <!-- API Key Button -->
            <div class="stone-btn" data-target="api-content">
                <div class="btn-content">
                    <img src="assets/icons/icon-api.png" class="icon-img" alt="API">
                    <span class="label" data-i18n="sidebar.apiKey">מפתח API</span>
                </div>
                <span class="status-indicator" id="api-key-indicator"></span>
            </div>

            <!-- Level Button -->
            <div class="stone-btn" data-target="level-content">
                <div class="btn-content">
                    <img src="assets/icons/icon-d20.png" class="icon-img" alt="Level">
                    <span class="label" data-i18n="sidebar.level">רמה</span>
                </div>
                <span class="selected-value" id="level-display-btn" data-i18n="levelSection.mundane">רגיל (ללא
                    כוח)</span>
            </div>

            <!-- Type Button -->
            <div class="stone-btn" data-target="type-content">
                <div class="btn-content">
                    <img src="assets/icons/icon-type.png" class="icon-img" alt="Type">
                    <span class="label" data-i18n="sidebar.typeAndDetails">סוג ופרטים</span>
                </div>
                <span class="selected-value" id="type-display-btn" data-i18n="typeSection.weapon">נשק</span>
            </div>

            <!-- Ability Button -->
            <div class="stone-btn" data-target="ability-content">
                <div class="btn-content">
                    <img src="assets/icons/icon-ability.png" class="icon-img" alt="Ability">
                    <span class="label" data-i18n="sidebar.abilityTheme">יכולת / נושא</span>
                </div>
            </div>

            <!-- Visuals Button -->
            <div class="stone-btn" data-target="visuals-content">
                <div class="btn-content">
                    <img src="assets/icons/icon-visuals.png" class="icon-img" alt="Visuals">
                    <span class="label" data-i18n="sidebar.visualsStyle">מראה וסגנון</span>
                </div>
                <span class="selected-value" id="style-display-btn" data-i18n="imageStyles.realistic">ריאליסטי</span>
            </div>
        </div>

        <!-- Scroll Content Area -->
        <div id="sidebar-scroll-area" class="scroll-container">

            <!-- 1. API Key Section -->
            <div id="api-content" class="scroll-section hidden">
                <h3 data-i18n="apiSection.title">הגדרות חיבור</h3>
                <div class="api-key-section">
                    <label for="api-key" data-i18n="apiSection.geminiLabel">🔑 Gemini API Key (Required)</label>
                    <input type="password" id="api-key" data-i18n-placeholder="apiSection.geminiPlaceholder"
                        placeholder="Paste your API key here..." />
                    <p class="help-text">
                        <a href="https://aistudio.google.com/apikey" target="_blank" style="color: #fbbf24;"
                            data-i18n="sidebar.geminiFreeKey">
                            👉 Get FREE API Key from Google AI Studio
                        </a>
                    </p>
                </div>
                <div class="api-key-section" style="margin-top: 1rem;">
                    <label for="getimg-api-key" data-i18n="apiSection.getimgLabel">GetImg API Key (Optional)</label>
                    <input type="password" id="getimg-api-key" data-i18n-placeholder="apiSection.getimgPlaceholder"
                        placeholder="Optional: For FLUX model..." />
                    <p class="help-text" data-i18n="apiSection.getimgHelp">Only needed if using GetImg model.</p>
                </div>
            </div>

            <!-- 2. Level Section -->
            <div id="level-content" class="scroll-section hidden">
                <h3 data-i18n="levelSection.title">רמת החפץ</h3>
                <div class="form-group">
                    <label for="item-level" data-i18n="levelSection.selectLabel">בחר רמה:</label>
                    <select id="item-level" name="level">
                        <option value="mundane" data-i18n="levelSection.mundane">רגיל (ללא כוח)</option>
                        <option value="1-4" data-i18n="levelSection.level1_4">1-4 (לא נפוץ)</option>
                        <option value="5-10" data-i18n="levelSection.level5_10">5-10 (נדיר)</option>
                        <option value="11-16" data-i18n="levelSection.level11_16">11-16 (נדיר מאוד)</option>
                        <option value="17+" data-i18n="levelSection.level17">17+ (אגדי)</option>
                    </select>
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="attunement">
                    <label for="attunement" data-i18n="levelSection.attunement">דורש התכווננות? (Requires
                        Attunement)</label>
                </div>

            </div>

            <!-- 3. Type & Details Section -->
            <div id="type-content" class="scroll-section hidden">
                <h3 data-i18n="typeSection.title">סוג ופרטים</h3>

                <!-- Type Selection -->
                <div class="form-group">
                    <label for="item-type" data-i18n="typeSection.mainTypeLabel">סוג חפץ ראשי</label>
                    <select id="item-type">
                        <option value="weapon" data-i18n="typeSection.weapon">נשק (Weapon)</option>
                        <option value="armor" data-i18n="typeSection.armor">שריון (Armor)</option>
                        <option value="wondrous" data-i18n="typeSection.wondrous">חפץ פלא (Wondrous Item)</option>
                        <option value="potion" data-i18n="typeSection.potion">שיקוי (Potion)</option>
                        <option value="ring" data-i18n="typeSection.ring">טבעת (Ring)</option>
                        <option value="scroll" data-i18n="typeSection.scroll">מגילה (Scroll)</option>
                        <option value="staff" data-i18n="typeSection.staff">מטה (Staff)</option>
                        <option value="wand" data-i18n="typeSection.wand">שרביט (Wand)</option>
                    </select>
                </div>

                <!-- Subtype (Dynamic) -->
                <div class="form-group hidden" id="subtype-container">
                    <label for="item-subtype" data-i18n="typeSection.subtypeLabel">חפץ ספציפי</label>
                    <select id="item-subtype" name="subtype">
                        <option value="" data-i18n="typeSection.subtypePlaceholder">-- בחר חפץ --</option>
                    </select>
                </div>

                <!-- Dynamic Fields Container -->
                <div id="dynamic-fields" class="dynamic-fields">
                    <!-- Weapon Fields -->
                    <div id="weapon-fields" class="hidden">
                        <div class="form-group">
                            <label for="weapon-damage" data-i18n="typeSection.damageLabel">נזק (Damage)</label>
                            <input type="text" id="weapon-damage" data-i18n-placeholder="sidebar.exampleDamage"
                                placeholder="e.g. 1d8">
                        </div>
                        <div class="form-group">
                            <label for="damage-type" data-i18n="typeSection.damageTypeLabel">סוג נזק (Damage
                                Type)</label>
                            <select id="damage-type">
                                <option value="slashing" data-i18n="damageTypes.slashing">חותך (Slashing)</option>
                                <option value="piercing" data-i18n="damageTypes.piercing">דוקר (Piercing)</option>
                                <option value="bludgeoning" data-i18n="damageTypes.bludgeoning">מוחץ (Bludgeoning)
                                </option>
                                <option value="fire" data-i18n="damageTypes.fire">אש (Fire)</option>
                                <option value="cold" data-i18n="damageTypes.cold">קור (Cold)</option>
                                <option value="lightning" data-i18n="damageTypes.lightning">ברק (Lightning)</option>
                                <option value="necrotic" data-i18n="damageTypes.necrotic">נקרוטי (Necrotic)</option>
                                <option value="radiant" data-i18n="damageTypes.radiant">קורן (Radiant)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Armor Fields -->
                    <div id="armor-fields" class="hidden">
                        <div class="form-group">
                            <label for="armor-class" data-i18n="typeSection.armorClassLabel">דירוג שריון (AC)</label>
                            <input type="number" id="armor-class" data-i18n-placeholder="sidebar.exampleAC"
                                placeholder="e.g. 15">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Ability / Theme Section -->
            <div id="ability-content" class="scroll-section hidden">
                <h3 data-i18n="abilitySection.title">יכולת או נושא</h3>

                <!-- Note pointing to the scroll in preview panel -->
                <div class="ability-selector-note"
                    style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 1rem;">
                    <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                        👈 בחר יכולות מהמגילה שמשמאל לקלף
                    </p>
                </div>

                <!-- Manual Ability Input (fallback) -->
                <div class="form-group">
                    <label for="item-ability" data-i18n="abilitySection.descriptionLabel">או תאר ידנית:</label>
                    <input type="text" id="item-ability" name="ability"
                        data-i18n-placeholder="abilitySection.placeholder"
                        placeholder="לדוגמה: להב אש, טבעת היעלמות..." />
                </div>
            </div>

            <!-- 5. Visuals Section -->
            <div id="visuals-content" class="scroll-section hidden">
                <h3 data-i18n="visualsSection.title">מראה וסגנון</h3>
                <div class="form-group">
                    <label for="custom-visual-prompt" data-i18n="visualsSection.customPromptLabel">תיאור ויזואלי ידני
                        (אופציונלי)</label>
                    <textarea id="custom-visual-prompt" rows="3"
                        data-i18n-placeholder="visualsSection.customPromptPlaceholder"
                        placeholder="תאר את החפץ באנגלית כדי לעקוף את התיאור האוטומטי... (למשל: A glowing blue sword with runes)"></textarea>
                    <p class="help-text" data-i18n="visualsSection.customPromptHelp">השאיר ריק כדי שה-AI יחליט לבד.</p>
                </div>

                <div class="form-group">
                    <label for="image-model" data-i18n="visualsSection.imageModelLabel">מודל תמונה</label>
                    <select id="image-model">
                        <option value="getimg-flux" selected data-i18n="imageModels.flux">GetImg: FLUX Schnell (מומלץ)
                        </option>
                        <option value="getimg-zimage" data-i18n="imageModels.zimage">Kie.ai: Z-Image Turbo (מהיר)
                        </option>
                        <option value="fal-zimage">FAL: Z-Image Turbo (חסכוני - 512px)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="image-style" data-i18n="visualsSection.imageStyleLabel">סגנון ציור</label>
                    <select id="image-style">
                        <option value="realistic" data-i18n="imageStyles.realistic">ריאליסטי (Realistic)</option>
                        <option value="watercolor" data-i18n="imageStyles.watercolor">צבעי מים (Watercolor)</option>
                        <option value="oil" data-i18n="imageStyles.oil">ציור שמן (Oil Painting)</option>
                        <option value="sketch" data-i18n="imageStyles.sketch">רישום עיפרון (Pencil Sketch)</option>
                        <option value="dark_fantasy" data-i18n="imageStyles.dark_fantasy">פנטזיה אפלה (Dark Fantasy)
                        </option>
                        <option value="epic_fantasy" data-i18n="imageStyles.epic_fantasy">פנטזיה אפית (Epic Fantasy)
                        </option>
                        <option value="anime" data-i18n="imageStyles.anime">אנימה (Anime)</option>
                        <option value="pixel" data-i18n="imageStyles.pixel">פיקסל ארט (Pixel Art)</option>
                        <option value="stained_glass" data-i18n="imageStyles.stained_glass">ויטראז' (Stained Glass)
                        </option>
                        <option value="simple_icon" data-i18n="imageStyles.simple_icon">אייקון שטוח (Flat Icon)</option>
                        <option value="ink_drawing" data-i18n="imageStyles.ink_drawing">דיו ביד (Ink Drawing)</option>
                        <option value="silhouette" data-i18n="imageStyles.silhouette">צללית (Silhouette)</option>
                        <option value="synthwave" data-i18n="imageStyles.synthwave">סינת'וייב (Synthwave)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="image-style-option" data-i18n="visualsSection.imageProcessingLabel">סגנון תמונה
                        (עיבוד)</label>
                    <select id="image-style-option">
                        <option value="natural" data-i18n="imageProcessing.natural">רקע טבעי (Natural)</option>
                        <option value="no-background" data-i18n="imageProcessing.no_background">בלי רקע (No BG)</option>
                        <option value="square-frame" data-i18n="imageProcessing.square_frame">מסגרת מרובעת (Square)
                        </option>
                        <option value="round-frame" data-i18n="imageProcessing.round_frame">מסגרת עגולה (Round)</option>
                        <option value="colored-background" data-i18n="imageProcessing.colored_background">רקע בצבע
                            (Color)</option>
                    </select>
                </div>

                <!-- Color Palette (Hidden by default) -->
                <div id="image-color-picker-container" class="form-group hidden">
                    <label data-i18n="visualsSection.colorPickerLabel">בחר צבע רקע:</label>
                    <div id="color-palette" class="color-palette-grid">
                        <!-- Colors will be injected by JS -->
                    </div>
                    <input type="hidden" id="image-bg-color" value="White">
                </div>
            </div>
        </div>



        <!-- Action Buttons -->
        <!-- Added z-index to ensure visibility over scroll menu -->
        <div class="action-buttons-container" style="position: relative; z-index: 100;">

            <!-- Visual Context Toggle (Moved here for visibility) -->
            <div class="form-group checkbox-group"
                style="margin-bottom: 1rem; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                <input type="checkbox" id="use-visual-context" checked>
                <label for="use-visual-context"
                    style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <span style="font-size: 1.2rem;">👁️</span>
                    <span data-i18n="actions.visualContext">התייחס למראה הקלף (Visual Context)</span>
                </label>
            </div>

            <!-- Split Generation Buttons -->
            <div class="generation-buttons" style="display: flex; gap: 0.5rem; width: 100%;">
                <button type="submit" id="generate-simple-btn" class="btn-create" style="flex: 1; min-width: 0;"
                    data-i18n-title="actions.simpleTooltip" data-tooltip="חפץ עם פלוסים ונזק בסיסי">
                    <img src="assets/icons/icon-swords.png" class="icon-img-sm" alt=""> <span
                        data-i18n="actions.simple">פשוט</span>
                </button>
                <button type="submit" id="generate-creative-btn" class="btn-create"
                    style="flex: 1; min-width: 0; background: linear-gradient(135deg, #9b59b6, #8e44ad); border-color: #8e44ad;"
                    data-i18n-title="actions.creativeTooltip" data-tooltip="חפץ עם מכניקה מיוחדת ומורכבת">
                    <img src="assets/icons/icon-amulet.png" class="icon-img-sm" alt=""> <span
                        data-i18n="actions.creative">יצירתי</span>
                </button>
            </div>

            <!-- Surprise Me Button (Full Width) -->
            <button type="button" id="surprise-btn" class="btn-surprise" style="width: 100%; margin-top: 0.5rem;">
                <img src="assets/icons/icon-d20.png" class="icon-img-sm" alt=""> <span data-i18n="actions.surprise">הפתע
                    אותי</span>
            </button>

            <!-- Regenerate Controls (Hidden by default, shown after generation) -->
            <div id="regenerate-controls" class="regenerate-row hidden">
                <button type="button" id="regen-image-btn" class="btn-secondary"
                    data-i18n-title="actions.regenImageTooltip" title="צור תמונה חדשה">
                    <img src="assets/icons/icon-brush.png" class="icon-img-sm" alt=""> <span
                        data-i18n="actions.regenImage">מראה</span>
                </button>
                <button type="button" id="regen-stats-btn" class="btn-secondary"
                    data-i18n-title="actions.regenStatsTooltip" title="צור תכונות חדשות">
                    <img src="assets/icons/icon-quill.png" class="icon-img-sm" alt=""> <span
                        data-i18n="actions.regenStats">תכונות</span>
                </button>
            </div>
            <div id="error-message" class="error-message hidden"></div>
    </form>
</aside>